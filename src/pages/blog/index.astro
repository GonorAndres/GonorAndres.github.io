---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogPostPreview from '../../components/ui/BlogPostPreview.astro';
import { t } from '../../i18n';
import OrganicBlob from '../../components/decorations/OrganicBlob.astro';

const posts = (await getCollection('blog'))
  .filter((p) => p.data.lang === 'es')
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const categories = ['actuaria-para-todos', 'proyectos-y-analisis', 'herramientas', 'mercado-mexicano'];
const categoryLabels: Record<string, string> = {
  'actuaria-para-todos': 'Actuaria para todos',
  'proyectos-y-analisis': 'Proyectos y analisis',
  'herramientas': 'Herramientas',
  'mercado-mexicano': 'Mercado mexicano',
};
---

<BaseLayout title="Blog | Andrés González Ortega" lang="es">
  <section class="relative py-16 px-6">
    <OrganicBlob variant={1} color="#D4A574" class="w-[400px] h-[400px] -top-16 -right-20 opacity-20" />

    <div class="max-w-4xl mx-auto relative z-10">
      <h1 class="text-3xl md:text-5xl font-bold text-navy mb-4 fade-up">{t('es', 'section.blog')}</h1>

      <div class="flex flex-wrap gap-2 mb-10 fade-up">
        <a href="/blog/" class="text-sm px-3 py-1 rounded-full bg-terracotta text-cream">
          {t('es', 'blog.allPosts')}
        </a>
        {categories.map((cat) => (
          <a href={`/blog/categoria/${cat}/`} class="text-sm px-3 py-1 rounded-full bg-sage/15 text-sage hover:bg-sage/25 transition-colors">
            {categoryLabels[cat]}
          </a>
        ))}
      </div>

      <div class="space-y-6">
        <!-- Interactive content (not from collection) -->
        <article class="group p-6 rounded-2xl border border-terracotta/30 bg-terracotta/5 hover:shadow-md hover:-translate-y-0.5 transition-all fade-up">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-xs px-2 py-0.5 rounded-full bg-terracotta/20 text-terracotta font-medium">Interactivo</span>
            <span class="text-xs px-2 py-0.5 rounded-full bg-sage/15 text-sage font-medium">herramientas</span>
          </div>
          <h3 class="font-serif text-lg font-bold text-navy mb-2 group-hover:text-terracotta transition-colors">
            <a href="/blog/visualizaciones-matematicas/">
              Visualizaciones Matemáticas Interactivas
            </a>
          </h3>
          <p class="text-sm text-navy/60 mb-3">Demostraciones interactivas de conceptos fundamentales del análisis: límite sin(x)/x, derivada del seno y la fórmula de Euler. Con visualizaciones SVG manipulables.</p>
          <a href="/blog/visualizaciones-matematicas/" class="text-sm font-medium text-terracotta hover:text-terracotta/80 transition-colors">
            Explorar demostraciones &rarr;
          </a>
        </article>

        {posts.map((post) => (
          <BlogPostPreview
            title={post.data.title}
            description={post.data.description}
            slug={post.slug}
            date={post.data.date}
            category={post.data.category}
            lang="es"
          />
        ))}
      </div>

      {posts.length === 0 && (
        <p class="text-navy/50 text-center py-12">Proximamente se publicaran articulos.</p>
      )}
    </div>
  </section>
</BaseLayout>
