---
import type { Lang } from '../../i18n';
import { t } from '../../i18n';
import type { ProjectCategory } from '../../data/projects';
import { getRelatedProjectNames } from '../../data/projects';
import CategoryBadge from './CategoryBadge.astro';

interface Props {
  title: string;
  description: string;
  url: string;
  platform: string;
  category: ProjectCategory;
  tags?: string[];
  variant?: 'standard' | 'tall' | 'wide';
  lang: Lang;
  relatedTo?: string[];
}

const { title, description, url, platform, category, tags = [], variant = 'standard', lang, relatedTo } = Astro.props;

const variantClasses: Record<string, string> = {
  standard: '',
  tall: 'md:row-span-2',
  wide: 'md:col-span-2',
};

const categoryColors: Record<ProjectCategory, string> = {
  'actuarial': 'bg-terracotta/10 border-terracotta/30',
  'data-science': 'bg-sage/10 border-sage/30',
  'quant-finance': 'bg-amber/10 border-amber/30',
  'applied-math': 'bg-navy/10 border-navy/30',
};

const categoryBadgeColors: Record<ProjectCategory, string> = {
  'actuarial': 'bg-terracotta/20 text-terracotta',
  'data-science': 'bg-sage/20 text-sage',
  'quant-finance': 'bg-amber/20 text-amber',
  'applied-math': 'bg-navy/20 text-navy',
};

const categoryKey = `projects.${category}` as keyof typeof import('../../i18n/es').default;

const relatedNames = relatedTo ? getRelatedProjectNames(relatedTo, lang) : [];
---

<article
  class:list={[
    'group relative flex flex-col rounded-2xl border p-6 transition-all hover:shadow-lg hover:-translate-y-1 fade-up',
    categoryColors[category],
    variantClasses[variant],
  ]}
>
  <!-- Category indicator -->
  <div class="flex items-center gap-2 mb-3">
    <span class:list={[
      'text-xs font-medium px-2 py-0.5 rounded-full',
      categoryBadgeColors[category],
    ]}>
      {t(lang, categoryKey)}
    </span>
    <span class="text-xs text-navy/40">{platform}</span>
  </div>

  <h3 class="font-serif text-lg font-bold text-navy mb-2 group-hover:text-terracotta transition-colors">
    {title}
  </h3>

  <p class="text-sm text-navy/60 flex-1 mb-4">
    {description}
  </p>

  {tags.length > 0 && (
    <div class="flex flex-wrap gap-1.5 mb-4">
      {tags.map((tag) => (
        <CategoryBadge label={tag} />
      ))}
    </div>
  )}

  {relatedNames.length > 0 && (
    <p class="text-xs text-navy/40 mb-3 italic">
      {t(lang, 'projects.seeAlso')} {relatedNames.join(', ')}
    </p>
  )}

  <a
    href={url}
    target="_blank"
    rel="noopener noreferrer"
    class="inline-flex items-center gap-1 text-sm font-medium text-terracotta hover:text-terracotta/80 transition-colors"
  >
    {t(lang, 'projects.viewProject')}
    <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
    </svg>
  </a>
</article>
